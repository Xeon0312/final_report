---
title: "How the 2019 Canadian Federal Election would have been different if 'everyone' had voted"
author: "Cao Boyu"
thanks: "Code and data are available at: https://github.com/Xeon0312/final_report/"
date: "`r format(Sys.time(), '%d %B %Y')`"
fontsize: 12pt
sansfont: Calibri Light
bibliography: references.bib
abstract: |
  In this paper, we develop two models with the purpose of forecasting how the 
  2019 Canadian Federal Election would have been different if 'everyone' had 
  voted. Multilevel regression with postratification (MRP) and Stacked 
  regression with postratification models where constructed using the 2019 
  Canadian Election Study survey and postsratified using the 2016 Canadian 
  Education Highlight Tables census dataset. We concluded that if "everyone" 
  votes, there is a high probability that there is no obvious difference
  
  **Keywords:** Forecasting; 2019 Canadian Federal Election; Multilevel Regression with Poststratification; No different
header-includes: 
- \usepackage{float} #use the 'float' package
- \floatplacement{figure}{H} #make every figure with caption = h
output: 
  pdf_document:
    fig_cap: yes
    keep_tex: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = F)
knitr::opts_chunk$set(warning = F)

library(cesR)
library(labelled)
library(tidyverse)

ces2019_web <- read.csv("./input/ces2019_web_cleaned.csv")
gss_2017 <- read.csv("./input/gss.csv")
```
# 1 Introduction
The 2019 Canadian federal election (formally the 43rd Canadian general election) was held on October 21, 2019, to elect members of the House of Commons to the 43rd Canadian Parliament. The Liberal Party, led by incumbent Prime Minister Justin Trudeau, won 157 seats to form a minority government and lost the majority they had won in the 2015 election. The Liberals lost the popular vote to the Conservatives, which marks only the second time in Canadian history that a governing party formed a government while receiving less than 35 per cent of the national popular vote.The Conservative Party, led by Andrew Scheer, won 121 seats and remained the Official Opposition. The Bloc Québécois, under Yves-François Blanchet, won 32 seats to regain official party status and became the third party for the first time since 2008. The New Democratic Party, led by Jagmeet Singh, won 24 seats, its worst result since 2004. The Green Party, led by Elizabeth May, saw its best election results with three seats and for the first time received over one million votes.

However, the gap between the Conservative Party and the Liberal Party is not very large. When voters vote, they may be affected by other conditions that may cause some voters to absent or abstain. The final result may still be somewhat different from the real public opinion. This time, we use multilevel regression with postratification (MRP) and Stacked regression with postratification models to simulate the answer if 'everyone' had voted. For the data part, we are going to use 2019 Canadian Election Study survey and postsratified using the 2016 Canadian Education Highlight census dataset. Details will be in the Model section.

After a series of simulation experiments, we found that although the proportion of votes among the parties has changed, the overall result is the same as before. The Liberal Party is still elected by a narrow margin. This reflects that the public opinion of Canadian voters has been truly reflected and has not been affected by other factors.

# 2 Data

```{r loadData, include=FALSE}
ces2019_web <- read.csv("./input/ces2019_web_cleaned.csv")
gss_2017 <- read.csv("./input/gss.csv")
```

## 2019 CES

```{r makeGraph1, echo = FALSE, fig.cap = "Party Voted in CES2019 survey", out.extra = '',fig.width= 6, fig.height=4}
# Overall pie chart
ces_vote_frame <- ces2019_web %>% group_by(cps19_votechoice) %>% summarise(count = n())
total = sum(ces_vote_frame$count)
ces_vote_overall = ggplot(ces_vote_frame, aes(x = "Will vote to", y = count, fill = cps19_votechoice)) + 
  theme_void() +
  geom_bar(width = 2, stat = "identity") + 
  coord_polar("y", start=0) + 
  geom_text(aes(label = paste0(round(count/total*100), "%")), 
            color="black",position = position_stack(vjust = 0.5)) + guides(fill=guide_legend(title="Party Voted in CES2019 survey"))
ces_vote_overall
```
As can be seen, The Liberal Party and the Conservative Party are the two most mainstream parties with support ratings of 34% and 33% respectively. NDP and Green Party ranked third and fourth with 16% and 9% respectively

```{r makeGraph2, echo = FALSE, fig.cap = "How Respondents Plan to Vote in 2019 By Gender",out.extra = '',fig.width=15, fig.height=8}
ggplot(data = ces2019_web, aes(x= cps19_votechoice, fill = sex)) + geom_bar() + coord_flip()
```

It can be seen from the figure that the proportion of men and women in the voting population is similar, with slightly more women. Women accounted for the majority of votes obtained by NDP.

```{r makeGraph3, echo = FALSE, fig.cap = "How Respondents Plan to Vote in 2019 By Province",out.extra = '',fig.width=15, fig.height=8}
ggplot(data = ces2019_web, aes(x= cps19_votechoice, fill = province)) + geom_bar() + coord_flip()
```

It can be concluded from the figure that the proportion of people in Ontario who voted is higher. Interestingly, the votes of the Bloc Quebecois party only come from Quebec.

```{r makeGraph4, echo = FALSE, fig.cap = "How Respondents Plan to Vote in 2019 By education",out.extra = '',fig.width=15, fig.height=8}
ggplot(data = ces2019_web, aes(x= cps19_votechoice, fill = education)) + geom_bar() + coord_flip()
```

The data obtained from the graph shows that most of the voting population has higher education than high school. Those who voted for the Conservative Party had an average education level higher than those who voted for the Liberal Party.

## GSS Data
The dataset we used for our analysis came from responses to the "2017 General Social Survey (GSS): Families Cycle 31". The 2017 GSS, conducted from February 2nd to November 30th, 2017, is a sample survey with a cross-sectional design. The target population includes all non-institutionalized persons 15 years of age and older, living in the 10 provinces of Canada. The survey uses a new frame, created in 2013, that combines telephone numbers (landline and cellular) with Statistics Canada’s Address Register, and collects data via telephone. Data are subject to both sampling and non-sampling errors.
Each record in the survey frame was assigned to a stratum within its province. A simple random sample
without replacement of records was next performed in each stratum. The target sample size (i.e. the desired number of respondents) for the 2017 GSS was 20,000 while the actual number of respondents was 20,602.
The survey frame was created using two different components:
1. Lists of telephone numbers in use (both landline and cellular) available to Statistics Canada from
various sources (telephone companies, Census of population, etc.);
2. The Address Register (AR): List of all dwellings within the ten provinces.
The overall response rate for the 2017 GSS was 52.4%.

The target population for the 2017 GSS included all persons 15 years of age and older in Canada,
excluding:
1. Residents of the Yukon, Northwest Territories, and Nunavut; and
2. Full-time residents of institutions.
That will cause some data missing.

```{r makeGraph5, echo = FALSE, fig.cap = "GSS By Sex", out.extra = '',fig.width= 6, fig.height=4}
gss_gender_frame <- gss_2017 %>% group_by(sex) %>% summarise(count = n())
total = sum(gss_gender_frame$count)
gss_gender = ggplot(gss_gender_frame, aes(x = "Sex", y = count, fill = sex)) + 
  theme_void() +
  geom_bar(width = 2, stat = "identity") + 
  coord_polar("y", start=0) + 
  geom_text(aes(label = paste0(round(count/total*100), "%")), 
            color="black",position = position_stack(vjust = 0.5)) + guides(fill=guide_legend(title="Sex"))
gss_gender
```

```{r makeGraph6, echo = FALSE, fig.cap = "GSS By Age group", out.extra = '',fig.width= 6, fig.height=4}
gss_age_frame <- gss_2017 %>% group_by(agegroup) %>% summarise(count = n())
total = sum(gss_age_frame$count)
gss_age = ggplot(gss_age_frame, aes(x = "Age Group", y = count, fill = agegroup)) + 
  theme_void() +
  geom_bar(width = 2, stat = "identity") + 
  coord_polar("y", start=0) + 
  geom_text(aes(label = paste0(round(count/total*100), "%")), 
            color="black",position = position_stack(vjust = 0.5)) + guides(fill=guide_legend(title="Age Group"))
gss_age
```


```{r makeGraph7, echo = FALSE, fig.cap = "GSS By Education", out.extra = '',fig.width= 12, fig.height=8}
gss_edu_frame <- gss_2017 %>% group_by(education) %>% summarise(count = n())
total = sum(gss_edu_frame$count)
gss_edu = ggplot(gss_edu_frame, aes(x = "Education", y = count, fill = education)) + 
  theme_void() +
  geom_bar(width = 2, stat = "identity") + 
  coord_polar("y", start=0) + 
  geom_text(aes(label = paste0(round(count/total*100), "%")), 
            color="black",position = position_stack(vjust = 0.5)) + guides(fill=guide_legend(title="Education"))
gss_edu
```

```{r makeGraph8, echo = FALSE, fig.cap = "GSS By Province", out.extra = '',fig.width= 8, fig.height=6}
gss_pro_frame <- gss_2017 %>% group_by(province) %>% summarise(count = n())
total = sum(gss_pro_frame$count)
gss_pro = ggplot(gss_pro_frame, aes(x = "Province", y = count, fill = province)) + 
  theme_void() +
  geom_bar(width = 2, stat = "identity") + 
  coord_polar("y", start=0) + 
  geom_text(aes(label = paste0(round(count/total*100), "%")), 
            color="black",position = position_stack(vjust = 0.5)) + guides(fill=guide_legend(title="Province"))
gss_pro
```

# 3 Model



# 4 Results

```{r loadResult, echo = FALSE}
results_P = read_csv("./outputs/results/results_P.csv")
results_C = read_csv("./outputs/results/results_C.csv")
results_G = read_csv("./outputs/results/results_G.csv")
results_L = read_csv("./outputs/results/results_L.csv")
results_N = read_csv("./outputs/results/results_N.csv")
results_Q = read_csv("./outputs/results/results_Q.csv")
survey_data = ces2019_web %>% 
  select(province,cps19_votechoice)%>%
  table()%>%
  as.data.frame()

```

```{r makeGraph9, echo = FALSE, fig.cap = "Result of L Patry", out.extra = '',fig.width= 16, fig.height=6}
Province = results_L$province
Province[5] = "Newfoundland"
ggplot(results_L,aes(x=Province,y=mean,label = mean, fill = Province))+
  geom_bar(stat = "identity")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))
```

```{r makeGraph10, echo = FALSE, fig.cap = "Result of C Patry", out.extra = '',fig.width= 16, fig.height=6}
Province = results_C$province
Province[5] = "Newfoundland"
ggplot(results_C,aes(x=Province,y=mean,label = mean, fill = Province))+
  geom_bar(stat = "identity")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))
```

```{r makeGraph11, echo = FALSE, fig.cap = "Result of G Patry", out.extra = '',fig.width= 16, fig.height=6}
Province = results_G$province
Province[5] = "Newfoundland"
ggplot(results_G,aes(x=Province,y=mean,label = mean, fill = Province))+
  geom_bar(stat = "identity")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))
```

```{r makeGraph12, echo = FALSE, fig.cap = "Result of N Patry", out.extra = '',fig.width= 16, fig.height=6}
Province = results_N$province
Province[5] = "Newfoundland"
ggplot(results_N,aes(x=Province,y=mean,label = mean, fill = Province))+
  geom_bar(stat = "identity")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))
```


```{r makeGraph13, echo = FALSE, fig.cap = "Result of P Patry", out.extra = '',fig.width= 16, fig.height=6}
Province = results_P$province
Province[5] = "Newfoundland"
ggplot(results_P,aes(x=Province,y=mean,label = mean, fill = Province))+
  geom_bar(stat = "identity")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))
```


```{r makeGraph14, echo = FALSE, fig.cap = "Result of Q Patry", out.extra = '',fig.width= 16, fig.height=6}
Province = results_Q$province
Province[5] = "Newfoundland"
ggplot(results_Q,aes(x=Province,y=mean,label = mean, fill = Province))+
  geom_bar(stat = "identity")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))
```
# 5 Discussion

\pagebreak

# Appendix

\pagebreak

# References

- Stephenson, Laura B; Harell, Allison; Rubenson, Daniel; Loewen, Peter John, 2020, '2019 Canadian Election Study - Online Survey', https://doi.org/10.7910/DVN/DUS88V, Harvard Dataverse, V1

- Stephenson, Laura, Allison Harrel, Daniel Rubenson and Peter Loewen. Forthcoming. 'Measuring Preferences and Behaviour in the 2019 Canadian Election Study,' Canadian Journal of Political Science.

LINK: https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/DUS88V